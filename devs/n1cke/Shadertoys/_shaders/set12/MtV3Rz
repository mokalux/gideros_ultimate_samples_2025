{"Shader":{"ver":"0.1","info":{"id":"MtV3Rz","date":"1472896650","viewed":78,"name":"RayMarching5_sp","username":"SmartPointer","description":"A simple ray marcher.\nInspired by Shane","likes":0,"published":3,"flags":0,"tags":["raymarching"],"hasliked":0},"renderpass":[{"inputs":[],"outputs":[{"id":37,"channel":0}],"code":"const int MAX_ITER = 100;\nconst float EPSILON = 0.001;\n\nfloat sphereDist(vec3 rayPos, vec3 spherePos, float radius) {\n    return length(rayPos - spherePos) - radius;\n}\n\nfloat scene(vec3 rayPos) {\n    return sphereDist(rayPos, vec3(0.1), 1.6) + 0.04 * (\n                      (sin(-rayPos.x * 16.0 + iGlobalTime) * cos(-rayPos.y * 16.0 + iGlobalTime) * sin(-rayPos.z * 16.0 - iGlobalTime * 2.0)) +\n        \t\t\t  0.5*(sin(-rayPos.x * 32.0 + iGlobalTime * 0.2) * cos(-rayPos.y * 32.0 + iGlobalTime * 0.2) * sin(-rayPos.z * 16.0 + iGlobalTime * 0.2)));\n}\n\nvec3 getNormal(in vec3 p) {\n    return normalize(vec3(\n        scene(vec3(p.x + EPSILON, p.y, p.z)) - scene(vec3(p.x - EPSILON, p.y, p.z)),\n        scene(vec3(p.x, p.y + EPSILON, p.z)) - scene(vec3(p.x, p.y - EPSILON, p.z)),\n        scene(vec3(p.x, p.y, p.z + EPSILON)) - scene(vec3(p.x, p.y, p.z - EPSILON))\n    ));\n}\n\nvec3 applyLighting(vec3 color, vec3 rayPos, vec3 lightPos, vec3 cameraOrigin) {\n    vec3 n = getNormal(rayPos);\n\n    \/\/ diffuse\n    vec3 l = normalize(lightPos - rayPos);\n    color = vec3(color.x, color.y, color.z);\n    vec3 diffuseColor = 4.0 * color * max(dot(n, l), 0.0);\n    \n    \/\/ specular\n    vec3 r = normalize(reflect(l, n));\t\t\t\/\/vec3 r = normalize((2.0 * dot(n, l)) * n - l);\n    float s = max(dot(normalize(-cameraOrigin - rayPos), r), 0.0);\n    vec3 specularColor = color * pow(s, 128.0) * 2.0;\n    \n    \/\/return specularColor;\n    return specularColor + diffuseColor;\n}\n\nvoid mainImage(out vec4 fragColor, in vec2 fragCoord) {\n    vec3 color = vec3(0.0);\n\n    \/\/ camera\n    vec3 cameraTarget = vec3(0.0);\n    \/\/vec3 cameraOrigin = vec3(2.5 * cos(iGlobalTime * 0.1), 2.5 * cos(iGlobalTime * 0.1), 2.5 * sin(iGlobalTime * 0.1));\n    vec3 cameraOrigin = vec3(0.0, 0.0, 2.7);\n    vec3 cameraDir = normalize(cameraTarget - cameraOrigin);\n    vec3 up = vec3(0.0, 1.0, 0.0);\n    vec3 cameraRight = normalize(cross(cameraDir, up));\n    vec3 cameraUp = normalize(cross(cameraRight, cameraDir));\n\n    \/\/ screen\n    vec2 screenPos = fragCoord.xy \/ iResolution.xy * 2.0 - 1.0;\n    screenPos.x *= iResolution.x \/ iResolution.y;\n    \n    vec3 pixel = cameraOrigin + cameraDir + cameraRight * screenPos.x + cameraUp * screenPos.y;\n    vec3 rayDir = normalize(pixel - cameraOrigin);\n\n    vec3 sphereColor = vec3(0.1, 0.2, 0.3); \n    float totalDist = 0.0;\n    for (int i = 0; i < MAX_ITER; i++) {\n        vec3 rayPos = rayDir * totalDist + cameraOrigin;\n        float dist = scene(rayPos);\n        totalDist += dist;\n        if (dist < EPSILON) {\n            color = applyLighting(sphereColor, rayPos, vec3(0.0, 1.0, 2.3), cameraOrigin);\n            break;\n        }\n    }\n\n    fragColor = vec4(color, 1.0);\n}\n","name":"Image","description":"","type":"image"}]}}